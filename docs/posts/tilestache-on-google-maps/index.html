<!doctype html><html lang=en><head><title>Tilestache on google maps :: Varun Pant — WebLog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Introduction In this post I will demonstrate how to add custom TileStache map tiles on google maps, using google maps JavaScript API V3. TileStache has emerged as one of the easiest way to render your own map .There are many examples out there on creating basic tiles and then adding them on top of Leaftlet or Openlayers. In this post I will add them as an overlay on Google Maps."><meta name=keywords content="Cloud,maps,GIS,Google Cloud,Google Maps,Openlayer,Javascript,go,Hadoop,BigData,Spark"><meta name=robots content="noodp"><link rel=canonical href=https://varunpant.com/posts/tilestache-on-google-maps/><link rel=stylesheet href=https://varunpant.com/assets/style.css><link rel=stylesheet href=https://varunpant.com/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://varunpant.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://varunpant.com/img/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:title content="Tilestache on google maps"><meta name=twitter:description content="Introduction In this post I will demonstrate how to add custom TileStache map tiles on google maps, using google maps JavaScript API V3. TileStache has emerged as one of the easiest way to render your own map .There are many examples out there on creating basic tiles and then adding them on top of Leaftlet or Openlayers. In this post I will add them as an overlay on Google Maps."><meta property="og:title" content="Tilestache on google maps"><meta property="og:description" content="Introduction In this post I will demonstrate how to add custom TileStache map tiles on google maps, using google maps JavaScript API V3. TileStache has emerged as one of the easiest way to render your own map .There are many examples out there on creating basic tiles and then adding them on top of Leaftlet or Openlayers. In this post I will add them as an overlay on Google Maps."><meta property="og:type" content="article"><meta property="og:url" content="https://varunpant.com/posts/tilestache-on-google-maps/"><meta property="article:published_time" content="2014-12-26T00:00:00+00:00"><meta property="article:modified_time" content="2014-12-26T00:00:00+00:00"><meta property="og:site_name" content="Varun Pant"></head><body><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h2 class=post-title><a href=https://varunpant.com/posts/tilestache-on-google-maps/>Tilestache on google maps</a></h2><div class=post-meta><span class=post-date>2014-12-26</span>
<span class=post-author>— Varun Pant</span>
<span class=post-read-time>— 3 min read</span></div><div class=post-content><h3 id=introduction>Introduction</h3><p>In this post I will demonstrate how to add custom TileStache map tiles on google maps, using google maps JavaScript API V3. TileStache has emerged as one of the easiest way to render your own map .There are many examples out there on creating basic tiles and then adding them on top of Leaftlet or Openlayers. In this post I will add them as an overlay on Google Maps.</p><h3 id=overlays>Overlays</h3><p>In Google’s terminology, adding a map layer basically means adding an overlay. Here is an example on adding a <a href=https://developers.google.com/maps/documentation/javascript/examples/groundoverlay-simple>Ground Overlay.</a> Here is another one called <a href=https://developers.google.com/maps/documentation/javascript/examples/overlay-simple>Custom overlay.</a> Basically there is a concept of map types and is documented <a href=https://developers.google.com/maps/documentation/javascript/maptypes>here</a> in great detail, just skip past the Standard map types and scroll to Custom Map Types. This example, of a <a href=https://developers.google.com/maps/documentation/javascript/examples/maptype-base>Basic Map Type</a> proved to be most helpful. In case you are after adding your own Base Map, instead of an Overlay, then take a look at this <a href=https://developers.google.com/maps/documentation/javascript/examples/maptype-image>example</a>.</p><h3 id=tilemill-and-tilestache>TileMill and TileStache</h3><p>Ok, so now lets quickly create a map server side. In my Map I have a Uk District polygon layer which have been computed to get a count score with UK Crime DataSet November 2014, I simply used Point inside a polygon feature in Qgis to get a score. Then I styled the data using Carto Css in TileMill to a get a Heat Map Like effect. <img src=http://www.varunpant.com/static/resources/tilestachedemo/image00.png alt></p><p>Here is the Carto Css if you are wondering.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=color:#75715e>/* Color variables */</span>
@<span style=color:#66d9ef>r1</span><span style=color:#f92672>:</span>#28ee00;
@<span style=color:#66d9ef>r2</span><span style=color:#f92672>:</span>#4fee00;
@<span style=color:#66d9ef>r3</span><span style=color:#f92672>:</span>#77ee00;
@<span style=color:#66d9ef>r4</span><span style=color:#f92672>:</span>#9fee00;
@<span style=color:#66d9ef>r5</span><span style=color:#f92672>:</span>#c6ee00;
@<span style=color:#66d9ef>r6</span><span style=color:#f92672>:</span>#eec600;
@<span style=color:#66d9ef>r7</span><span style=color:#f92672>:</span>#ee9f00;
@<span style=color:#66d9ef>r8</span><span style=color:#f92672>:</span>#ee7700;
@<span style=color:#66d9ef>r9</span><span style=color:#f92672>:</span>#ee4f00;
@<span style=color:#66d9ef>r10</span><span style=color:#f92672>:</span>#ee2800;
<span style=color:#75715e>/* Layers */</span>
#sectors {
<span style=color:#960050;background-color:#1e0010>[</span><span style=color:#960050;background-color:#1e0010>z</span><span style=color:#960050;background-color:#1e0010>o</span><span style=color:#960050;background-color:#1e0010>o</span><span style=color:#960050;background-color:#1e0010>m</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#960050;background-color:#1e0010>8</span><span style=color:#960050;background-color:#1e0010>]</span>
<span style=color:#960050;background-color:#1e0010>{</span>
  line-width:<span style=color:#ae81ff>0.2</span>;
  polygon-opacity:<span style=color:#ae81ff>0.9</span>;
}
<span style=color:#f92672>[</span><span style=color:#f92672>zoom</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>=</span><span style=color:#f92672>8</span><span style=color:#f92672>]</span>
{
line-width:<span style=color:#ae81ff>0.8</span>;
 polygon-opacity:<span style=color:#ae81ff>0.7</span>;
}

<span style=color:#f92672>[</span><span style=color:#f92672>zoom</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>=</span><span style=color:#f92672>12</span><span style=color:#f92672>]</span>
{
line-width:<span style=color:#ae81ff>1</span>;
 polygon-opacity:<span style=color:#ae81ff>0.6</span>;
}
<span style=color:#f92672>[</span><span style=color:#f92672>zoom</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>20</span><span style=color:#f92672>]</span>
{
  line-width:<span style=color:#ae81ff>1.2</span>;
  polygon-opacity:<span style=color:#ae81ff>0.4</span>;
}

<span style=color:#f92672>line-opacity</span><span style=color:#f92672>:</span> <span style=color:#f92672>1</span><span style=color:#f92672>;</span>
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span><span style=color:#f92672>=</span><span style=color:#f92672>0</span><span style=color:#f92672>]</span>{polygon-opacity:<span style=color:#ae81ff>0</span>;line-opacity:<span style=color:#ae81ff>0</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>0</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>24</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r1;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>24</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>48</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r2;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>48</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>72</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r3;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>72</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>96</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r4;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>96</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>120</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r5;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>120</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>144</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r6;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>144</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>168</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r7;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>168</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>192</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r8;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>192</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> <span style=color:#f92672>216</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r9;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#f92672>[</span><span style=color:#f92672>PNTCNT</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>216</span><span style=color:#f92672>]</span>{polygon-fill:<span style=color:#f92672>@</span>r10;line-color:<span style=color:#ae81ff>#FFF</span>;}
<span style=color:#960050;background-color:#1e0010>}</span>


</code></pre></div><p>Its very easy to export Mapnik Configuration xml of your TileMill Project. <img src=http://www.varunpant.com/static/resources/tilestachedemo/image02.png alt></p><p>This is my Map configuration for TileStache.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>{
<span style=color:#e6db74>&#34;cache&#34;</span><span style=color:#f92672>:</span>
{
  <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Test&#34;</span>,
  <span style=color:#e6db74>&#34;path&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/tmp/stache&#34;</span>,
  <span style=color:#e6db74>&#34;umask&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;0000&#34;</span>
},
<span style=color:#e6db74>&#34;layers&#34;</span><span style=color:#f92672>:</span>
{
   <span style=color:#e6db74>&#34;sectors&#34;</span><span style=color:#f92672>:</span>
   {
       <span style=color:#e6db74>&#34;provider&#34;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mapnik&#34;</span>, <span style=color:#e6db74>&#34;mapfile&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;crime.xml&#34;</span>},
       <span style=color:#e6db74>&#34;projection&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;spherical mercator&#34;</span>
   }
}
}


</code></pre></div><p>Finally start the server . TileStache-master/scripts/tilestache-server.py -c /path/to/my/configuration/tiles.cfg</p><h3 id=creating-a-custom-overlay-for-google-maps>Creating a Custom Overlay for Google Maps</h3><p>Its quite easy to add a TileStache Overlay on top of google maps. TileStache URLs are already based on a Google Maps-like scheme: /{layer name}/{zoom}/{column}/{row}.{extension} So we create a CoordMapType overlay.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>/** @constructor */</span>
 <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>CoordMapType</span>(<span style=color:#a6e22e>tileSize</span>) {
   <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tileSize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tileSize</span>;
 }
 <span style=color:#a6e22e>CoordMapType</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>getTile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>coord</span>, <span style=color:#a6e22e>zoom</span>, <span style=color:#a6e22e>ownerDocument</span>) {
   <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ownerDocument</span>.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;img&#39;</span>);
   <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:8080/sectors/&#34;</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>zoom</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>coord</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>coord</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;.png&#34;</span>;
   <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tileSize</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;px&#39;</span>;
   <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tileSize</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;px&#39;</span>;
   <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>img</span>;
 };

<span style=color:#e6db74>`</span><span style=color:#e6db74>`</span><span style=color:#e6db74>`</span><span style=color:#e6db74>javascript
</span><span style=color:#e6db74>and then we simply add this overlay to map to overlayMapTypes . </span><span style=color:#e6db74>`</span><span style=color:#e6db74>`</span><span style=color:#e6db74>`</span>
<span style=color:#a6e22e>map</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>google</span>.<span style=color:#a6e22e>maps</span>.<span style=color:#a6e22e>Map</span>(document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;map-canvas&#39;</span>),
     <span style=color:#a6e22e>mapOptions</span>);
   <span style=color:#a6e22e>map</span>.<span style=color:#a6e22e>overlayMapTypes</span>.<span style=color:#a6e22e>insertAt</span>(
     <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CoordMapType</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>google</span>.<span style=color:#a6e22e>maps</span>.<span style=color:#a6e22e>Size</span>(<span style=color:#ae81ff>256</span>, <span style=color:#ae81ff>256</span>)));

</code></pre></div><p>and thats it, we are done. Here is a screenshot of how the map looks.</p><p><img src=http://www.varunpant.com/static/resources/tilestachedemo/image01.png alt></p><p>I have added a working sample <a href=http://www.varunpant.com/static/resources/tilestachedemo/distribution.zip>here </a>, incase you wanna check out the full source code. Hope this helps.</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://varunpant.com/posts/creating-isochrones-and-isodistances-using-googles-direction-search-api/><span class=button__icon>←</span>
<span class=button__text>Creating Isochrones and Isodistances using Googles Direction Search API</span></a></span>
<span class="button next"><a href=https://varunpant.com/posts/merge-multiple-shapefiles-using-ogr2ogr-in-windows-linux-or-osx/><span class=button__text>Merge multiple Shapefiles using OGR2OGR in windows Linux or OSX</span>
<span class=button__icon>→</span></a></span></div></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"varunpant"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2019 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by <a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://varunpant.com/assets/main.js></script><script src=https://varunpant.com/assets/prism.js></script></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-16978408-1','auto');ga('send','pageview');}</script></body></html>
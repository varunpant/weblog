<!doctype html><html lang=en><head><title>Read GAE Admin Backups fromLevelDB format and export GAE Entities using bulkloader :: Varun Pant — WebLog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Google datastore is pretty awesome when one needs a quick no-sql data storage. However recently I have experienced a problem in exporting my GAE Datastore as csv and in certain cases as a line delimited Json file. Its not very hard to do so and perhaps the easiest way to handle such thing is to write an export handler in you web app, however, there are alternative ways which I have highlighted below."><meta name=keywords content="Cloud,maps,GIS,Google Cloud,Google Maps,Openlayer,Javascript,go,Hadoop,BigData,Spark"><meta name=robots content="noodp"><link rel=canonical href=https://varunpant.com/posts/read-gae-admin-backups-fromleveldb-format-and-export-gae-entities-using-bulkloader/><link rel=stylesheet href=https://varunpant.com/assets/style.css><link rel=stylesheet href=https://varunpant.com/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://varunpant.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://varunpant.com/img/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:title content="Read GAE Admin Backups fromLevelDB format and export GAE Entities using bulkloader"><meta name=twitter:description content="Google datastore is pretty awesome when one needs a quick no-sql data storage. However recently I have experienced a problem in exporting my GAE Datastore as csv and in certain cases as a line delimited Json file. Its not very hard to do so and perhaps the easiest way to handle such thing is to write an export handler in you web app, however, there are alternative ways which I have highlighted below."><meta property="og:title" content="Read GAE Admin Backups fromLevelDB format and export GAE Entities using bulkloader"><meta property="og:description" content="Google datastore is pretty awesome when one needs a quick no-sql data storage. However recently I have experienced a problem in exporting my GAE Datastore as csv and in certain cases as a line delimited Json file. Its not very hard to do so and perhaps the easiest way to handle such thing is to write an export handler in you web app, however, there are alternative ways which I have highlighted below."><meta property="og:type" content="article"><meta property="og:url" content="https://varunpant.com/posts/read-gae-admin-backups-fromleveldb-format-and-export-gae-entities-using-bulkloader/"><meta property="article:published_time" content="2016-01-11T00:00:00+00:00"><meta property="article:modified_time" content="2016-01-11T00:00:00+00:00"><meta property="og:site_name" content="Varun Pant"></head><body><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h2 class=post-title><a href=https://varunpant.com/posts/read-gae-admin-backups-fromleveldb-format-and-export-gae-entities-using-bulkloader/>Read GAE Admin Backups fromLevelDB format and export GAE Entities using bulkloader</a></h2><div class=post-meta><span class=post-date>2016-01-11</span>
<span class=post-author>— Varun Pant</span>
<span class=post-read-time>— 3 min read</span></div><div class=post-content><p>Google datastore is pretty awesome when one needs a quick no-sql data storage. However recently I have experienced a problem in exporting my GAE Datastore as csv and in certain cases as a line delimited Json file. Its not very hard to do so and perhaps the easiest way to handle such thing is to write an export handler in you web app, however, there are alternative ways which I have highlighted below. 2. One of the easiest alternative is by using <a href="https://console.cloud.google.com/project/_/datastore/settings?_ga=1.52544424.12031260.1450181862">Datastore Admin .</a> This tool will easily let you backup you GAE DataStore Entities to google cloud storage in the same project which can later be downloaded locally, by using cloud console or gsutil like this gsutil cp -R /gs/your_bucket_name/your_path /local_target
4. Then there is <a href=https://cloud.google.com/appengine/docs/python/tools/remoteapi>Remote API for python and Java</a>, which perhaps was created to modify the datastore directly via code from your local machine
6. Finally there is a python utility called bulkloader.py which is coupled with <strong>remote_api</strong>i , this utility does require python sdk to be installed and added to your system path.</p><h3 id=using-the-bulk-loader-tool>Using the Bulk Loader Tool</h3><p>To quickly verify if <strong>bulkloader</strong> is correctly installed simply type bulkloader.py</p><blockquote><p>If you have a Python application, you can use the appcfg.py upload_data and appcfg.py download_data commands to do data uploads and downloads. These are equivalent to bulkloader.py, but can also derive the application ID and the remote API URL from your app.yaml file. (Future releases may make more bulkloader features available via appcfg.py; check the App Engine website for the latest.) f you have a Java application, you just run the bulkloader.py tool, specifying the application ID and remote API URL as command-line arguments: bulkloader.py &ndash;app<em>id=app-id &ndash;url=http://app-id.appspot.com/remote</em>api The loader tool keeps track of its progress during an upload or download in a data file and can begin from where it last left incase the process is interrupted, this feature requires sqlite3 installed though which can be verified by typing squlite3 in the shell. One of the easiest features of the bulk loader to use is the backup and restore feature. The bulk loader can download every entity of a given kind to a data file, and can upload that data file back to the app to restore those entities. #### To Download all entities</p></blockquote><p>bulkloader.py &ndash;dump &ndash;app<em>id=app-id &ndash;url=http://app-id.appspot.com/remote</em>api &ndash;kind=kind &ndash;filename=backup.dat #### To Upload all entitites</p><p>bulkloader.py &ndash;restore &ndash;app<em>id=app-id &ndash;url=http://app-id.appspot.com/remote</em>api &ndash;kind=kind &ndash;filename=backup.dat</p><blockquote><p>When using &ndash;dump and &ndash;restore, entities are not validated using the app’s model classes. They are dumped and restored directly as they appear in the datastore. Entity keys are preserved, including system-assigned numeric IDs. Properties with key values will remain valid as long as the entities they are referring to are in the app, or are part of the dump being restored. Restoring an entity with the same key as an existing entity will replace the existing entity. There are clever ways to read csv and upload data into appengine datastore using bulkloader which I will explain in another post, however for those who have been taking dumps using the admin tool, here is quick python code to read entities from the backup files which are in Googles <a href=https://github.com/google/leveldb>level DB format</a> import sys,datetime sys.path.append('/usr/local/google_appengine/') sys.path.append('/usr/local/google_appengine/lib/yaml/lib/') if &lsquo;google&rsquo; in sys.modules: del sys.modules[&lsquo;google&rsquo;] from google.appengine.api.files import records from google.appengine.datastore import entity_pb from google.appengine.api import datastore import unicodecsv as csv from pprint import pprint toCSV = [] def getKeyName(r): entity_proto = entity_pb.EntityProto(contents=r) for element in entity_proto.key().path().element_list(): if element.has_name(): return element.name() def getProto(r): entity_proto = entity_pb.EntityProto(contents=r) return datastore.Entity.FromPb(entity_proto) fls = [&lsquo;output-0&rsquo;,&lsquo;output-1&rsquo;,&lsquo;output-2&rsquo;,&lsquo;output-3&rsquo;,&lsquo;output-4&rsquo;] for f in fls: raw = open(f, &lsquo;r&rsquo;) reader = records.RecordsReader(raw) for record in reader: entity = getProto(record) entity[u"name&rdquo;] = getKeyName(record) # pprint(entity) toCSV.append(entity) print &ldquo;-"*50 # pprint(entity) # for key in entity.keys(): # print key + " - " + str(type(entity[key])) keys = toCSV[0].keys() with open(&lsquo;settings.csv&rsquo;, &lsquo;wb&rsquo;) as output_file: dict_writer = csv.DictWriter(output_file, keys,encoding='utf-8&rsquo;) dict_writer.writeheader() dict_writer.writerows(toCSV)</p></blockquote></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://varunpant.com/posts/how-to-use-google-appengine-remote-api-for-java/><span class=button__icon>←</span>
<span class=button__text>How to use Google Appengine Remote API for Java</span></a></span>
<span class="button next"><a href=https://varunpant.com/posts/serving-raster-layers-on-google-cloud-platform/><span class=button__text>Serving raster layers on Google Cloud Platform</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2019 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by <a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://varunpant.com/assets/main.js></script><script src=https://varunpant.com/assets/prism.js></script></div></body></html>
<!doctype html><html lang=en><head><title>How to create fishnets or geospatial grids :: Varun Pant — WebLog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="There are many use cases in GIS world, where the information has to be aggregated, an easy way to achieve this is via gridding or binning, where the area of interest is divided into small sections called grids or bins.
These sections are mostly of rectangular form (which can be easily converted into geotiffs), but in some cases even circles or hexagons are also used.
You can read a good tutorial from mapbox using Qgis with a mmqgis plugin here."><meta name=keywords content="Cloud,maps,GIS,Google Cloud,Google Maps,Openlayer,Javascript,go,Hadoop,BigData,Spark"><meta name=robots content="noodp"><link rel=canonical href=/posts/how-to-create-fishnets-or-geospatial-grids/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:title content="How to create fishnets or geospatial grids"><meta name=twitter:description content="There are many use cases in GIS world, where the information has to be aggregated, an easy way to achieve this is via gridding or binning, where the area of interest is divided into small sections called grids or bins.
These sections are mostly of rectangular form (which can be easily converted into geotiffs), but in some cases even circles or hexagons are also used.
You can read a good tutorial from mapbox using Qgis with a mmqgis plugin here."><meta property="og:title" content="How to create fishnets or geospatial grids"><meta property="og:description" content="There are many use cases in GIS world, where the information has to be aggregated, an easy way to achieve this is via gridding or binning, where the area of interest is divided into small sections called grids or bins.
These sections are mostly of rectangular form (which can be easily converted into geotiffs), but in some cases even circles or hexagons are also used.
You can read a good tutorial from mapbox using Qgis with a mmqgis plugin here."><meta property="og:type" content="article"><meta property="og:url" content="/posts/how-to-create-fishnets-or-geospatial-grids/"><meta property="article:published_time" content="2016-12-11T00:00:00+00:00"><meta property="article:modified_time" content="2016-12-11T00:00:00+00:00"><meta property="og:site_name" content="Varun Pant"></head><body><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archives>Archives</a></li><li><a href=/feed.xml>Feed</a></li><li><a href=/showcase>Showcase</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h2 class=post-title><a href=/posts/how-to-create-fishnets-or-geospatial-grids/>How to create fishnets or geospatial grids</a></h2><div class=post-meta><span class=post-date>2016-12-11</span>
<span class=post-author>— Varun Pant</span>
<span class=post-read-time>— 4 min read</span></div><div class=post-content><p>There are many use cases in GIS world, where the information has to be aggregated, an easy way to achieve this is via gridding or binning, where the area of interest is divided into small sections called grids or bins.</p><p>These sections are mostly of rectangular form (which can be easily converted into geotiffs), but in some cases even circles or hexagons are also used.</p><p><img src=/media/image_963791002841481453621913.png alt></p><p>You can read a good tutorial from <a href=https://www.mapbox.com/>mapbox</a> using <a href=http://www.qgis.org/en/site/>Qgis</a> with a <a href=http://michaelminn.com/linux/mmqgis/>mmqgis</a> plugin <a href=https://www.mapbox.com/blog/binning-alternative-point-maps/>here</a>.</p><p>While MMQGIS is a good enough for most use cases, I was looking for a way to create fishnets or grids by giving the bbox of the region and width/height in meters, which would then make it easy to script the process for any dynamic use.</p><p>Luckily there is a &ldquo;recipe&rdquo; available which takes input in <a href=EPSG:3857>EPSG:3857</a> projections and hence takes the width/height of grid cell in meter, <a href=https://pcjericks.github.io/py-gdalogr-cookbook/vector_layers.html#create>here</a>.</p><p>The code is pretty easy to comprehend and creates simple polygons for each computed cell in the layer.</p><p>import os, sys import ogr from math import ceil def main(outputGridfn,xmin,xmax,ymin,ymax,gridHeight,gridWidth): # convert sys.argv to float xmin = float(xmin) xmax = float(xmax) ymin = float(ymin) ymax = float(ymax) gridWidth = float(gridWidth) gridHeight = float(gridHeight) # get rows rows = ceil((ymax-ymin)/gridHeight) # get columns cols = ceil((xmax-xmin)/gridWidth) # start grid cell envelope ringXleftOrigin = xmin ringXrightOrigin = xmin + gridWidth ringYtopOrigin = ymax ringYbottomOrigin = ymax-gridHeight # create output file outDriver = ogr.GetDriverByName(&lsquo;ESRI Shapefile&rsquo;) if os.path.exists(outputGridfn): os.remove(outputGridfn) outDataSource = outDriver.CreateDataSource(outputGridfn) outLayer = outDataSource.CreateLayer(outputGridfn,geom_type=ogr.wkbPolygon ) featureDefn = outLayer.GetLayerDefn() # create grid cells countcols = 0 while countcols &lt; cols: countcols += 1 # reset envelope for rows ringYtop = ringYtopOrigin ringYbottom =ringYbottomOrigin countrows = 0 while countrows &lt; rows: countrows += 1 ring = ogr.Geometry(ogr.wkbLinearRing) ring.AddPoint(ringXleftOrigin, ringYtop) ring.AddPoint(ringXrightOrigin, ringYtop) ring.AddPoint(ringXrightOrigin, ringYbottom) ring.AddPoint(ringXleftOrigin, ringYbottom) ring.AddPoint(ringXleftOrigin, ringYtop) poly = ogr.Geometry(ogr.wkbPolygon) poly.AddGeometry(ring) # add new geom to layer outFeature = ogr.Feature(featureDefn) outFeature.SetGeometry(poly) outLayer.CreateFeature(outFeature) outFeature.Destroy # new envelope for next poly ringYtop = ringYtop - gridHeight ringYbottom = ringYbottom - gridHeight # new envelope for next poly ringXleftOrigin = ringXleftOrigin + gridWidth ringXrightOrigin = ringXrightOrigin + gridWidth # Close DataSources outDataSource.Destroy() if __name__ == &ldquo;__main__": # # example run : $ python grid.py .shp xmin xmax ymin ymax gridHeight gridWidth # if len( sys.argv ) != 8: print &ldquo;[ ERROR ] you must supply seven arguments: output-shapefile-name.shp xmin xmax ymin ymax gridHeight gridWidth&rdquo; sys.exit( 1 ) main( sys.argv[1], sys.argv[2], sys.argv[3], sys.argv[4], sys.argv[5], sys.argv[6], sys.argv[7] ) Here is an example usage: python grid.py grid.shp 992325.66 1484723.41 494849.32 781786.14 10000 10000</p><p>Here is an example of a 10km/10 km grid</p><p><img src=/media/image_1504214621671481454352189.png alt></p><p>Python scripts are generally usable in most use cases, how ever incase one needs a Postgis alternative, i.e a function which runs in Postgis database and creates a fishnet in a table, then It might be useful to use a query which I found <a href=http://gis.stackexchange.com/questions/16374/how-to-create-a-regular-polygon-grid-in-postgis>here</a>.</p><p>CREATE OR REPLACE FUNCTION public.makegrid_2d ( bound_polygon public.geometry, grid_step integer, metric_srid integer = 3857 &ndash;metric SRID ) RETURNS public.geometry AS $body$ DECLARE BoundM public.geometry; &ndash;Bound polygon transformed to the metric projection (with metric_srid SRID) Xmin DOUBLE PRECISION; Xmax DOUBLE PRECISION; Ymax DOUBLE PRECISION; X DOUBLE PRECISION; Y DOUBLE PRECISION; sectors public.geometry[]; i INTEGER; BEGIN BoundM := ST_Transform($1, $3); &ndash;From WGS84 (SRID 4326) to the metric projection, to operate with step in meters Xmin := ST_XMin(BoundM); Xmax := ST_XMax(BoundM); Ymax := ST_YMax(BoundM); Y := ST_YMin(BoundM); &ndash;current sector's corner coordinate i := -1; &lt;> LOOP IF (Y > Ymax) THEN &ndash;Better if generating polygons exceeds the bound for one step. You always can crop the result. But if not you may get not quite correct data for outbound polygons (e.g. if you calculate frequency per sector) EXIT; END IF; X := Xmin; &lt;> LOOP IF (X > Xmax) THEN EXIT; END IF; i := i + 1; sectors[i] := ST_GeomFromText(&lsquo;POLYGON((&lsquo;||X||&rsquo; &lsquo;||Y||&rsquo;, &lsquo;||(X+$2)||&rsquo; &lsquo;||Y||&rsquo;, &lsquo;||(X+$2)||&rsquo; &lsquo;||(Y+$2)||&rsquo;, &lsquo;||X||&rsquo; &lsquo;||(Y+$2)||&rsquo;, &lsquo;||X||&rsquo; &lsquo;||Y||&rsquo;))', $3); X := X + $2; END LOOP xloop; Y := Y + $2; END LOOP yloop; RETURN ST_Transform(ST_Collect(sectors), ST_SRID($1)); END; $body$ LANGUAGE &lsquo;plpgsql&rsquo;; I hope this helps.</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/using-geotiff-as-datasource-via-gdal/><span class=button__icon>←</span>
<span class=button__text>Using Geotiff as datasource via gdal</span></a></span>
<span class="button next"><a href=/posts/how-to-transform-projections-between-spherical-mercator-and-epsg-4326/><span class=button__text>How to transform projections between Spherical Mercator and EPSG 4326</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Varun Pant</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2019 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by <a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>